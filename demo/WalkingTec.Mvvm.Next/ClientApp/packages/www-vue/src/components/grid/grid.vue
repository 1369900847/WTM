<template>
  <ag-grid-vue
    style="height: 500px;"
    class="ag-theme-material"
    :gridOptions="GridOptionsProps"
    :rowData="rowData"
    :columnDefs="columnDefs"
  ></ag-grid-vue>
</template>

<script lang="ts">
import { AgGridVue } from "ag-grid-vue/lib/AgGridVue";
import lodash from "lodash";
import { LicenseManager } from "ag-grid-enterprise";
import { Component, Prop, Vue } from "vue-property-decorator";
import { GridOptions, GridReadyEvent } from "ag-grid-community";
import { Subscription, fromEvent } from "rxjs";
import { Debounce } from "lodash-decorators";
LicenseManager.setLicenseKey(
  "ag-Grid_Evaluation_License_Not_for_Production_100Devs30_August_2037__MjU4ODczMzg3NzkyMg==9e93ed5f03b0620b142770f2594a23a2"
);
@Component({
  components: {
    AgGridVue
  }
})
export default class AgGrid extends Vue {
  @Prop() GridOptions: GridOptions;
  @Prop({ default: [] }) rowData!: any;
  @Prop({ default: [] }) columnDefs!: any;
  // 事件对象
  ResizeEvent: Subscription;
  GridReadyEvent: GridReadyEvent;
  GridOptionsProps: GridOptions = lodash.merge<GridOptions, GridOptions>(
    {
      // columnDefs
      // groupUseEntireRow:true,
      sideBar: {
        toolPanels: [
          {
            id: "columns",
            labelDefault: "Columns",
            labelKey: "columns",
            iconKey: "columns",
            toolPanel: "agColumnsToolPanel",
            toolPanelParams: {
              // suppressRowGroups: true,
              suppressValues: true,
              suppressPivots: true,
              suppressPivotMode: true
              // suppressSideButtons: true,
              // suppressColumnFilter: true,
              // suppressColumnSelectAll: true,
              // suppressColumnExpandAll: true
            }
          },
          {
            id: "filters",
            labelDefault: "Filters",
            labelKey: "filters",
            iconKey: "filter",
            toolPanel: "agFiltersToolPanel"
          }
        ]
      },
      masterDetail: true,
      suppressNoRowsOverlay: true,
      rowGroupPanelShow: "always",
      defaultColDef: {
        minWidth: 150,
        enableRowGroup: true,
        resizable: true
      },
      onGridReady: event => {
        this.GridReadyEvent = event;
        this.GridEvents.sizeColumnsToFit();
      }
    },
    this.GridOptions
  );
  GridEvents = {
    sizeColumnsToFit: () => this.GridReadyEvent.api.sizeColumnsToFit()
  };
  @Debounce(200)
  onCalculation() {
    this.GridEvents.sizeColumnsToFit();
  }
  mounted() {
    this.ResizeEvent = fromEvent(window, "resize").subscribe(e => {
      this.onCalculation();
    });
  }
  destroyed() {
    this.ResizeEvent && this.ResizeEvent.unsubscribe();
  }
  beforeMount() {}
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style lang="less">
@import "~ag-grid-community/dist/styles/ag-grid.css";
@import "~ag-grid-community/dist/styles/ag-theme-balham.css";
@import "~ag-grid-community/dist/styles/ag-theme-material.css";
@import "~ant-design-vue/es/style/themes/default.less";
.ag-theme-material {
  .ag-icon-checkbox-checked {
    color: @primary-color !important;
  }
}
</style>
